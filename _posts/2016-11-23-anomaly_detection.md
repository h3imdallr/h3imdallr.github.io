---
layout: post
published: True
title:  "anomaly_detection"
date:   2016-12-23 14:34:25
categories: data_science
tags: data_science, anomaly_detection
image: https://www.google.co.kr/images/branding/googlelogo/2x/googlelogo_color_272x92dp.png
---


#### abstract
- _이상탐지의 기초적인 개념, 시계열 데이터의 기본적 이해, 이를 통한 시계열 이상탐지 방법 소개_
- _code/ipynb provided (github link)_

#### reference
- [Statistical Learning Based Anomaly Detection @Twitter](http://www.slideshare.net/arunkejariwal/statistical-learning-based-anomaly-detection-twitter)
- [Anomaly Detection Twitter Github](https://github.com/twitter/AnomalyDetection)
- [Twitter's Blog on Anomaly Detection ](https://blog.twitter.com/2015/introducing-practical-and-robust-anomaly-detection-in-a-time-series)

#### Anomaly Definition:
기존 관측과는 상이하여 다른 매커니즘에 의해 생성되었다고 판단할만한 관측값. (An anomaly is an observation that deviates so much from other observations so as to arouse suspicious that it is was generated by different mechanism.)

#### Approaches on Anomaly Detection:

Anomaly Detection 은 그 자체가 알고리즘이라기 보다는 ‘목표하는바/기대하는 결과’에 해당하며, 여러 알고리즘과 분석론을 활용한 ‘분석 application’ 이라고 볼 수 있다. 따라서, 해결하고자 하는 문제의 목적과 컨텍스트에 따라 이상탐지 목적은 상이해 질 수 있다.   
이상탐지의 문제 특징(Problem Characteristics) 파악 및 구체적 분석방법론 수립시 고려할 사항들은 아래와 같다.

(1) 목적(Objectives)  

- 기회 탐지 Chance discovery (Positive anomaly)
- 오류 탐지 Fault Discovery (Negative Anomaly)
- 새로움의 탐지 Novelty Detection
- 노이즈 제거 Noise Removal

(2) 입력 데이터의 특성(Nature of input data)  

- 시계열 Time-Series(sequential) vs Static
- 단변량/다변량 Univariate vs Multivariate
- 데이터 타입 Data Type (Binary /Categorical /Continuous /Hybrid)
- 상호의존적/독립적 Relational vs Independent
- (기존 룰의 적용이 가능할 만큼) 잘 알려진/알려져 있지 않은 Well-known or not (rule existing or not)

(3) 이상값의 종류(Type of anomaly)  

이상값의 종류는 보는 시간에 따라 다를 수 있어 엄밀한 규정을 하긴 어렵다.  
미네소타 대학의 Survey paper에는 아래와 같이 규정하고 있다. *(source: <Anomaly Detection: A Survey>, 2009, Varun Chandola)*

![taxonomy of anomaly detection](/figure-post/20161123-taxonomy.png)

위의 분류를 최대한 간소화 시키면, 결국 축적된 시간동안 정적인 점분포에 초점을 맞추는 Point anomaly 와, 시계열적인 동적인 특성에 주안을 두는 Context anomaly로 구분 지을수 있다.

| 분류  | 특징
| :------------ | :-----------: |
| Point anomaly   | Statistics(Gaussian distribution) , Clustering, Classification         
| Contextual anomaly  | Statistics(Gaussian Process Regression, S-H-ESD ...) |  


앞서 밝혔듯, 이는 굉장히 단순화 시킨 구분이고, 결국 이상탐지를 위해선 '정상 상태'를 규정해야하고, 이는 당면한 과제, 도메인 특성에 따라 상이하게 달라진다. 아래는 다양한 방법으로 이상탐지가 분석 될 수 있음을 내포한다.

![schema](/figure-post/20161123-schema.png)

### Contextual Anomaly 분석 방법의 이해
#### A. 시계열 데이터 이해

본 글에서 소개하는 이상탐지 기법(S-H-ESD)의 이해를 위해서는 시계열 패턴 요소의 선행적 이해가 요구된다.  
![TSpattern](/figure-posts/20161123-TS_pattern.png)

- 추세(Trend): 장기적으로 나타나는 변동 패턴
- 계절성(Seasonal): 주,월,분기,반기 단위 등 이미 알려진 시간의 주기로 나타나는 패턴
- 주기(Cyclic): 최소 2 년 단위로 나타나는 고정된 기간이 아닌 장기적인 변동
- 랜덤요소/잔차 (Random/Residual/Remainder): 그 이외의 성분

#### B. S-H-ESD 기법의 이해

SNS 서비스인 트위터는 기존의 통계적 방법들을 조합하여 시계열의 이상값을 탐지하는 방법을 제안한다. (S-H-ESD)
간략히 요약하면, 아래와 같이 기존 방법의 문제에 대응하는 새로운 방법을 제안한다.

| 기존 이상탐지 방법의 한계  |
| :------------ |
| 1. 잘못된 계산 지표 (Using Wrong Metric): 기존의 단순 평균$\mu$, 표준편차$\sigma$를 이용하는 방식 자체가 outlier를 포괄하여 계산하므로 이상값에 취약   |
| 2. Multi-modality에 취약: 평규과 표준편차가 seasonality, trend 등에 의해 변화되어 outlier를 놓치게 되는 경우가 발생|
||
| **S-H-ESD 기법의 이상탐지 방법** |
| 1. Use Robust Statistics/Metric: <br/> a. Median Absolute Deviation(MAD) <br/> b. Grubb’s Test& Generalized Extreme Studentized Deviate (ESD)|
| 2. Remove impact of seasonality and trend (Multi-modality aware): <br/> a. Seasonal Trend decomposition using Loess(STL) |

위 표에서 밝힌 S-H-ESD 기법을 좀더 자세히 이해하려면, 다음과 같은 통계학적 개념들의 이해가 요구된다.


* Median Absolute Deviation(MAD)
* Student t-distribution
* Extreme Studentized Deviate (ESD) test
* Generalized ESD
* Seasonal Trend decomposition using Loess(STL)


** Median Absolute Deviation(MAD); 중위수(중앙값) 절대 편차 : **  
중위수 절대 편차는 표본그룹의 중앙값( $ 𝑋 $ )과 각 표본( $ \bar { X } $ )의 차이값의 절대값을 취해서 중앙값을 추출하는 방법. 양적 자료의 퍼짐을 알고 싶을 때, 표본분산과 표준편차 보다 이상치에 덜 영향을 받는 강건성 robustness 있는 분산 측정 방법.








You’ll find this post in your `_posts` directory. Go ahead and edit it and re-build the site to see your changes. You can rebuild the site in many different ways, but the most common way is to run `jekyll serve --watch`, which launches a web server and auto-regenerates your site when a file is updated.

To add new posts, simply add a file in the `_posts` directory that follows the convention `YYYY-MM-DD-name-of-post.ext` and includes the necessary front matter. Take a look at the source for this post to get an idea about how it works.

Jekyll also offers powerful support for code snippets:

{% highlight ruby %}
def print_hi(name)
  puts "Hi, #{name}"
end
print_hi('Tom')
#=> prints 'Hi, Tom' to STDOUT.
{% endhighlight %}

Check out the [Jekyll docs][jekyll] for more info on how to get the most out of Jekyll. File all bugs/feature requests at [Jekyll’s GitHub repo][jekyll-gh]. If you have questions, you can ask them on [Jekyll’s dedicated Help repository][jekyll-help].

{% highlight js %}

<footer class="site-footer">
 <a class="subscribe" href="{{ "/feed.xml" | prepend: site.baseurl }}"> <span class="tooltip"> <i class="fa fa-rss"></i> Subscribe!</span></a>
  <div class="inner">a
   <section class="copyright">All content copyright <a href="mailto:{{ site.email}}">{{ site.name }}</a> &copy; {{ site.time | date: '%Y' }} &bull; All rights reserved.</section>
   <section class="poweredby">Made with <a href="http://jekyllrb.com"> Jekyll</a></section>
  </div>
</footer>
{% endhighlight %}


[jekyll]:      http://jekyllrb.com
[jekyll-gh]:   https://github.com/jekyll/jekyll
[jekyll-help]: https://github.com/jekyll/jekyll-help
